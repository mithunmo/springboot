var app=angular.module("adminConsoleApp","ngAnimate adminFilters rzModule multi-select ui.bootstrap ngModal".split(" ")).config(["$locationProvider",function(a){a.html5Mode(!0)}]);app.controller("dashboard",["$scope","$http","$rootScope","$sce",function(a,e,g,c){a.data=[];a.users=[];a.filteredUsers=null;a.loadCompleted=!1;a.sortOpt=[1,1,1,1,1,1,1,1,1,1];a.sortIcon={};a.selectedUsers={};a.usersName={};a.mailEntry={};a.isEditing={};for(var d in a.sortOpt)a.sortIcon[d]="glyphicon-chevron-up";a.render=function(){var b=(a.currentPage+1)*a.rowsPerPage,c=a.currentPage*a.rowsPerPage;b>=a.data.users.length&&(b=a.data.users.length);a.upperBound=b;a.lowerBound=c;a.users=null==a.filteredUsers?a.data.users.slice(c,b):a.filteredUsers.slice(c,b)};a.updateRows=function(){a.totalPages=Math.floor(a.data.users.length/a.rowsPerPage);0==a.data.users.length%a.rowsPerPage&&(a.totalPages-=1);a.render()};a.getRecordsByPage=function(b,c,d){e({method:"GET",url:"/f4g/admin/usersviewer/list?p="+b}).success(function(b){c?(a.data.users=a.data.users.concat(b.users),angular.extend(a.signupdate,b.effectiveDateHM)):(a.data=b,a.signups=b.usersCount,a.signupsDisplay=b.usersCount,a.signupdate=b.effectiveDateHM,a.expdate=b.expDateHM);a.mergeData();a.updateRows();"function"==typeof d&&d()}).error(function(){})};a.mergeData=function(){for(var b in a.data.users)a.data.users[b].effectiveDate=a.data.effectiveDateHM[a.data.users[b].userId],a.data.users[b].expDate=a.data.expDateHM[a.data.users[b].userId]};a.workerDone=function(){a.loadCompleted=!0};a.workerProgress=function(){a.loadingProgress=Math.floor(100*(a.data.users.length/a.data.usersCount));-1!=a.sortingOpt&&null!=a.sortingOpt&&void 0!=a.sortingOpt&&a.sort(a.sortingOpt.option,a.sortingOpt.order);-1!=a.searchingOpt&&null!=a.searchingOpt&&void 0!=a.searchingOpt&&a.userSearch()};a.worker=function(){a.workerPage<=a.data.totalPages?(a.getRecordsByPage(a.workerPage++,!0,a.worker),a.workerProgress()):a.workerDone()};a.getRecords=function(){a.signupsDisplay="---";a.workerPage=2;a.getRecordsByPage(1,!1,function(){a.worker()})};a.nextPage=function(){a.currentPage=a.currentPage+1>a.totalPages?0:a.currentPage+1;a.render()};a.prevPage=function(){a.currentPage=0>a.currentPage-1?a.totalPages:a.currentPage-1;a.render()};a.sort=function(b,c){var d=a.sortOpt[b];void 0!=c&&(d=c);a.loadCompleted?a.sortingOpt.option=0:(a.sortingOpt.option=b,a.sortingOpt.order=d);switch(b){case 1:a.data.users.sort(function(a,b){return a.firstname+" "+a.lastname>b.firstname+" "+b.lastname?-1*d:a.firstname+" "+a.lastname===b.firstname+" "+b.lastname?0:1*d});break;case 2:a.data.users.sort(function(a,b){return a.userName>b.userName?-1*d:a.userName===b.userName?0:1*d});break;case 3:a.data.users.sort(function(a,b){var c=new Date(a.effectiveDate.replace(/-/g,"/")),f=new Date(b.effectiveDate.replace(/-/g,"/"));return c.getTime()>f.getTime()?-1*d:c.getTime()===f.getTime()?0:1*d});break;case 4:a.data.users.sort(function(a,b){return a.adminRating>b.adminRating?-1*d:a.adminRating===b.adminRating?0:1*d});break;case 5:a.data.users.sort(function(a,b){return a.registerStatus.description>b.registerStatus.description?-1*d:a.registerStatus.description===b.registerStatus.description?0:1*d});break;case 6:a.data.users.sort(function(a,b){return a.profileScore>b.profileScore?-1*d:a.profileScore===b.profileScore?0:1*d});break;case 7:a.data.users.sort(function(a,b){var c="",f="";void 0!=a.howDidYouHearAboutUs&&null!=a.howDidYouHearAboutUs&&(c=a.howDidYouHearAboutUs.trim());void 0!=b.howDidYouHearAboutUs&&null!=b.howDidYouHearAboutUs&&(f=b.howDidYouHearAboutUs.trim());return c>f?-1*d:c===f?0:1*d})}a.render();a.sortOpt[b]=void 0==c?0-a.sortOpt[b]:0-c;a.sortIcon[b]=0>a.sortOpt[b]?"glyphicon-chevron-down":"glyphicon-chevron-up"};a.dateChange=function(){a.filteredUsers=[];for(var b in a.data.users){var c=new Date(a.data.users[b].effectiveDate);(void 0==a.dt_start||a.dt_start<c)&&(void 0==a.dt_end||a.dt_end>c)&&a.filteredUsers.push(a.data.users[b])}a.render()};a.userSearch=function(){a.filteredUsers=[];if(""!=a.keyword.trim()&&void 0!=a.keyword){var b=a.keyword.trim().toUpperCase().replace(/\s+/g,".*"),b=RegExp(b,"i");a.searchingOpt=a.loadCompleted?null:b;for(var c in a.data.users)(-1!=(a.data.users[c].firstname+a.data.users[c].lastname).toUpperCase().replace(/\s/g,"").search(b)||-1!=a.data.users[c].userName.toUpperCase().replace(/\s/g,"").search(b))&&a.filteredUsers.push(a.data.users[c])}else a.filteredUsers=null;0!=a.currentPage&&(a.currentPage=0);a.render()};a.sendMsg=function(){a.showMsgBox=!a.showMsgBox};a.archived=function(){};a.hide=function(){};a.reload=function(){a.getRecords(1)};a.getExamplesCount=function(){a.examplesCount="---";a.boardsCount="---";e({method:"POST",url:ajaxPaths.dashboardPath,responseType:"text"}).success(function(b){!1==b.hasError&&(a.examplesCount=b.examplesCount,a.boardsCount=b.boardsCount)}).error(function(){})};a.navigate=function(b){""!=b&&void 0!=b&&!isNaN(parseInt(b))&&b<a.data.users.length&&0<b&&(a.currentPage=Math.floor(b/a.rowsPerPage),0==b%a.rowsPerPage&&a.currentPage--,a.render())};a.navigateHandler=function(b){(void 0==b||13==b.keyCode)&&a.navigate(a.itemIndex)};a.updateUserCount=function(b){var c=0,d;for(d in a.selectedUsers)!0==a.selectedUsers[d]&&c++;void 0!=b&&(a.usersName[b.userId]={name:b.firstname+" "+b.lastname,status:"pending"});a.selectedUsersCount=c};a.deleteRecipient=function(b){a.selectedUsers[b]=!1;a.updateUserCount()};a.clearMessageHandler=function(b){a.selectedUsers={};a.updateUserCount();"all"==b&&(a.mailEntry={})};a.sendMessageHandler=function(){if(void 0!=a.mailEntry.mailSubject&&""!=a.mailEntry.mailSubject.trim()&&void 0!=a.mailEntry.mailContent&&""!=a.mailEntry.mailContent.trim()&&0<a.selectedUsersCount){for(var b in a.selectedUsers)!0==a.selectedUsers[b]&&(a.usersName[b].status="pending");for(b in a.selectedUsers)if(!0==a.selectedUsers[b]){a.usersName[b].status="sending";var c={mailUserId:0,mailSubject:a.mailEntry.mailSubject,mailContent:a.mailEntry.mailContent};c.mailUserId=b;a.sendMessage(c)}}};a.sendMessage=function(b){e({method:"POST",url:ajaxPaths.sendMailPath,params:b}).success(function(){a.usersName[b.mailUserId].status="success"}).error(function(){a.usersName[b.mailUserId].status="pending"})};a.showUserDetail=function(b){a.dialogShown=!0;a.dialogContent="";a.isDialogLoading=!0;e({method:"GET",url:ajaxPaths.usersViewerDetailPath+"&userId="+b}).success(function(b){console.log(b);a.dialogContent=c.trustAsHtml(b);a.isDialogLoading=!1}).error(function(){})};a.editAdminRating=function(b){a.isEditing[b]=!0};a.dt_start=null;a.dt_end=new Date;a.currentPage=0;a.totalPages=0;a.rowsPerPage=20;a.getRecords(1);a.sortingOpt={option:3,order:1};a.getExamplesCount();a.modalHeight="600px";a.modalWidth="800px"}]);app.factory("Property",function(){return{dateRange:{start:new Date,end:new Date}}});app.controller("adminSearch",["$scope","$http","$filter",function(a,e,g){a.asyncCompCount=0;a.syncIncompleted=!0;a.clear=function(c){a.boardLevelList={};a.boardLevelList[4]={};a.selectedBoardLevelList={};a.portfolioCount=0;a.criteria={};c&&(a.langList={},a.skillList={},a.specialtyList={},a.expertiseList={},a.educationList={});a.criteria.designerName="";a.criteria.ratings=0;a.criteria.country="";a.criteria.priceRange=0;a.criteria.langs=null;a.criteria.selectItemlangs=null;a.criteria.misc="";a.criteria.keywords="";a.adminRatingSlider={min:0,max:5,ceil:5,floor:0,step:1};a.buyerRatingSlider={min:0,max:5,ceil:5,floor:0,step:1};a.priceSlider={min:0,max:2e4,ceil:2e4,floor:0,step:25};a.dt_start=null;a.dt_end=new Date;a.clearMultiSelect(a.langList);a.clearMultiSelect(a.skillList);a.clearMultiSelect(a.specialtyList);a.clearMultiSelect(a.expertiseList);a.clearMultiSelect(a.educationList)};a.updateList=function(c,d){var b;4>c&&(1==c?(b=ajaxPaths.categoryListPath+"/"+a.criteria.division,a.boardLevelList[2]={},a.boardLevelList[3]={},a.boardLevelList[4]={},a.criteria.category=null,a.criteria.product=null):2==c?(b=ajaxPaths.productListPath+"/"+a.criteria.category,a.boardLevelList[3]={},a.boardLevelList[4]={},a.criteria.product=null):(b=ajaxPaths.productTypeListPath+"?level1="+a.criteria.division+"&level2="+a.criteria.category+"&productTags="+encodeURIComponent(a.criteria.product),a.boardLevelList[4]=""),a.criteria.productType=null,e({method:"GET",url:b}).success(function(b){a.boardLevelList[c+1]=b.list;"function"==typeof d&&d()}).error(function(){}))};a.syncMultiSelect=function(c,d,b){for(var f in c)for(var e in d)1==b&&c[f].name==d[e]&&(c[f].ticked=!0),2==b&&c[f].lookupValueId==d[e]&&(c[f].ticked=!0);null!=d&&0<d.length&&a.updateAsyncCompCount()};a.clearMultiSelect=function(a){for(var d in a)a[d].ticked=!1};a.updateAsyncCompCount=function(){a.asyncCompCount--;0==a.asyncCompCount&&(a.syncIncompleted=!1)};a.syncCriteria=function(c){null==c.division?c.division=void 0:(a.criteria.division=c.division,a.updateList(1));null==c.category?c.category=void 0:(a.asyncCompCount++,a.criteria.category=c.category,a.updateList(2,function(){a.updateAsyncCompCount();null!=c.product&&""!=c.product&&(a.criteria.product=c.product)}));null==c.product||""==c.product?c.product=void 0:(a.asyncCompCount++,a.criteria.product=c.product,a.updateList(3,function(){a.updateAsyncCompCount();null!=c.productType&&0<c.productType.length&&a.syncMultiSelect(a.boardLevelList[4],c.productType,1)}));null!=c.productType&&0<c.productType.length&&a.asyncCompCount++;null!=c.langs&&0<c.langs.length&&a.asyncCompCount++;null!=c.skills&&0<c.skills.length&&a.asyncCompCount++;null!=c.splId&&0<c.splId.length&&a.asyncCompCount++;null!=c.expId&&0<c.expId.length&&a.asyncCompCount++;null!=c.eduId&&0<c.eduId.length&&a.asyncCompCount++;null==c.season&&(c.season=void 0);null==c.country&&(c.country=void 0);a.adminRatingSlider.min=c.minAdminRating;a.adminRatingSlider.max=c.maxAdminRating;a.buyerRatingSlider.min=c.minBuyerRating;a.buyerRatingSlider.max=c.maxBuyerRating;a.priceSlider.min=c.minPrice;a.priceSlider.max=c.maxPrice;a.criteria=c;if(null!=c.portfolioSearchStartDate){var d=g("date")(c.portfolioSearchStartDate,"yyyy-MM-dd");a.dt_start=new Date(d)}null!=c.portfolioSearchEndDate&&(d=g("date")(c.portfolioSearchEndDate,"yyyy-MM-dd"),a.dt_end=new Date(d));0>=a.asyncCompCount&&(a.syncIncompleted=!1)};a.clear(!0);a.portfolioPagesCount="---";a.marketplaceSubmissionCount="---";a.profilesCount="---";a.examplesCount="---";e({method:"POST",url:ajaxPaths.searchCriteriaPath}).success(function(c){0==c.syncSearchResult?(a.portfolioPagesCount=0,a.marketplaceSubmissionCount=0,a.profilesCount=0,a.examplesCount=0,a.syncIncompleted=!1):(a.syncCriteria(c.syncSearchResult.form),a.portfolioPagesCount=c.syncSearchResult.portfolioPages.data.length,a.marketplaceSubmissionCount=c.syncSearchResult.marketplaceSubmission.data.length,a.profilesCount=c.syncSearchResult.profiles.data.length,a.examplesCount=c.syncSearchResult.examples.data.length)}).error(function(){});a.translate=function(a){return"$ "+a};e({method:"GET",url:ajaxPaths.langListPath}).success(function(c){a.langList=c.list;a.syncMultiSelect(c.list,a.criteria.langs,2)}).error(function(){});e({method:"GET",url:ajaxPaths.skillListPath}).success(function(c){a.skillList=c.list;a.syncMultiSelect(c.list,a.criteria.skills,2)}).error(function(){});e({method:"GET",url:ajaxPaths.specialtyListPath}).success(function(c){a.specialtyList=c.list;a.syncMultiSelect(c.list,a.criteria.splId,2)}).error(function(){});e({method:"GET",url:ajaxPaths.expertiseListPath}).success(function(c){a.expertiseList=c.list;a.syncMultiSelect(c.list,a.criteria.expId,2)}).error(function(){});e({method:"GET",url:ajaxPaths.educationListPath}).success(function(c){a.educationList=c.list;a.syncMultiSelect(c.list,a.criteria.eduId,2)}).error(function(){});a.search=function(){a.portfolioPagesCount="---";a.marketplaceSubmissionCount="---";a.profilesCount="---";a.examplesCount="---";a.criteria.portfolioSearchStartDate=null!=a.dt_start?a.dt_start.toDateString():null;a.criteria.portfolioSearchEndDate=null!=a.dt_end?a.dt_end.toDateString():null;a.criteria.minAdminRating=a.adminRatingSlider.min;a.criteria.maxAdminRating=a.adminRatingSlider.max;a.criteria.minBuyerRating=a.buyerRatingSlider.min;a.criteria.maxBuyerRating=a.buyerRatingSlider.max;a.criteria.minPrice=a.priceSlider.min;a.criteria.maxPrice=a.priceSlider.max;for(var c=[],d=0;d<a.selectedBoardLevelList[4].length;d++)c.push(a.selectedBoardLevelList[4][d].name);a.criteria.productType=c;c=[];for(d=0;d<a.selectedLangList.length;d++)c.push(a.selectedLangList[d].lookupValueId);a.criteria.langs=c;c=[];for(d=0;d<a.selectedSkillList.length;d++)c.push(a.selectedSkillList[d].lookupValueId);a.criteria.skills=c;c=[];for(d=0;d<a.selectedExpertiseList.length;d++)c.push(a.selectedExpertiseList[d].lookupValueId);a.criteria.expId=c;c=[];for(d=0;d<a.selectedSpecialtyList.length;d++)c.push(a.selectedSpecialtyList[d].lookupValueId);a.criteria.splId=c;c=[];for(d=0;d<a.selectedEducationList.length;d++)c.push(a.selectedEducationList[d].lookupValueId);a.criteria.eduId=c;a.isSearching=!0;e({method:"GET",url:ajaxPaths.searchResultPath,params:a.criteria}).success(function(b){a.isSearching=!1;a.portfolioPagesCount=b.result.portfolioPages.data.length;a.marketplaceSubmissionCount=b.result.marketplaceSubmission.data.length;a.profilesCount=b.result.profiles.data.length;a.examplesCount=b.result.examples.data.length}).error(function(){a.isSearching=!1})}}]);app.controller("adminSearchViewer",["$scope","$http","$filter","$location","$rootScope",function(a,e,g,c,d){a.columnNumber=10;a.showPanel={};a.loading={};a.boardDetail={};a.dt_start=null;a.dt_end=new Date;a.columnsPerRow=10;a.currentPage=0;a.totalPages=0;a.rowsPerPage=10;a.containerType={};a.selectedTab={};a.hasAdditionAccess=!1;a.isEmptyResult=!1;a.render=function(){var b=(a.currentPage+1)*a.rowsPerPage*a.columnsPerRow,c=a.currentPage*a.rowsPerPage*a.columnsPerRow;b>=a.data.length&&(b=a.data.length);a.upperBound=b;a.lowerBound=c;a.items=a.data.slice(c,b)};a.updateRows=function(){a.totalPages=Math.floor(a.data.length/(a.rowsPerPage*a.columnsPerRow));0==a.data.length%(a.rowsPerPage*a.columnsPerRow)&&(a.totalPages-=1);a.render()};a.nextPage=function(){a.currentPage=a.currentPage+1>a.totalPages?0:a.currentPage+1;a.render()};a.prevPage=function(){a.currentPage=0>a.currentPage-1?a.totalPages:a.currentPage-1;a.render()};a.syncCriteria=function(b){null!=b.productType&&0<b.productType.length&&a.asyncCompCount++;null!=b.langs&&0<b.langs.length&&a.asyncCompCount++;null!=b.skills&&0<b.skills.length&&a.asyncCompCount++;null!=b.splId&&0<b.splId.length&&a.asyncCompCount++;null!=b.expId&&0<b.expId.length&&a.asyncCompCount++;null!=b.eduId&&0<b.eduId.length&&a.asyncCompCount++;null==b.season&&(b.season=void 0);null==b.country&&(b.country=void 0);a.criteria=b;if(null!=b.portfolioSearchStartDate){var c=g("date")(b.portfolioSearchStartDate,"yyyy-MM-dd");a.dt_start=new Date(c)}null!=b.portfolioSearchEndDate&&(c=g("date")(b.portfolioSearchEndDate,"yyyy-MM-dd"),a.dt_end=new Date(c));0>=a.asyncCompCount&&(a.syncIncompleted=!1)};a.search=function(){a.isUpdating=!0;a.criteria.portfolioSearchStartDate=null!=a.dt_start?a.dt_start.toDateString():null;a.criteria.portfolioSearchEndDate=null!=a.dt_end?a.dt_end.toDateString():null;e({method:"GET",url:ajaxPaths.searchResultPath,params:a.criteria}).success(function(b){a.injectData(b.result);a.updateRows();a.isUpdating=!1}).error(function(){})};a.dateChange=function(){a.search()};a.updateData=function(){a.isUpdating=!0;a.isEmptyResult=!1;e({method:"POST",url:ajaxPaths.searchViewerPath}).success(function(b){0!=b.finalSearchResult&&void 0!=b.finalSearchResult?(a.injectData(b.finalSearchResult),a.syncCriteria(b.finalSearchResult.form),a.updateRows()):a.isEmptyResult=!0;a.isUpdating=!1}).error(function(){})};a.injectData=function(b){"portfolioPages"==a.containerType?(a.data=b.portfolioPages.data,a.hasAdditionAccess=!0):"marketplaceSubmissions"==a.containerType?(a.data=b.marketplaceSubmission.data,a.hasAdditionAccess=!1):"examples"==a.containerType&&(a.data=b.examples.data,a.hasAdditionAccess=!0)};a.navigate=function(b){""!=b&&void 0!=b&&!isNaN(parseInt(b))&&b<a.data.length&&0<b&&(a.currentPage=Math.floor(b/(a.rowsPerPage*a.columnsPerRow)),0==b%a.rowsPerPage&&a.currentPage--,a.render())};a.navigateHandler=function(b){(void 0==b||13==b.keyCode)&&a.navigate(a.itemIndex)};d.$on("$locationChangeStart",function(){a.containerType=c.hash();a.selectedTab={};a.selectedTab[c.hash()]="selected";a.updateData(a.containerType);a.currentPage=0;a.closeDetail();a.itemIndex=null});a.getDetail=function(b,c,d){a.loading[d]="loading";a.detailIndex=d;a.isSelected={};e({method:"GET",url:ajaxPaths.boardDetailPath+"/"+c}).success(function(b){var c=Math.floor(d/a.columnsPerRow);a.boardDetail=b;a.showPanel={};a.showPanel[c]=!0;a.loading={};a.isSelected[d]="selected"}).error(function(){})};a.closeDetail=function(b){void 0!=b?a.showPanel[Math.floor(b/a.columnsPerRow)]="":a.showPanel={};a.isSelected={}};a.showImageWindow=function(a){e({method:"GET",url:ajaxPaths.imageSizeRetrieverPath+"?img="+a}).success(function(c){var d=screen.width,e=screen.height,g=c.imageWidth;c=c.imageHeight;g>=.9*d&&(g=.9*d);c>=.85*e&&(c=.85*e);window.open(ajaxPaths.imageViewerPath+"?img="+a,"_blank","width="+g+",height="+c+",scrollbars=yes,toolbar=no,location=0")}).error(function(){})};a.filterList=function(a,c){var d=[];if(void 0!=a)for(var e=0;e<a.length;e++)1==a[e].publishToMP&&1==a[e].activeStatus&&a[e].boardId!=c&&d.push(a[e]);return d};a.showImgInfo=function(b){return a.showPanel[Math.floor(b/a.columnsPerRow)]}}]);app.controller("datePickerController",["$scope",function(a){a.open=function(e){e.preventDefault();e.stopPropagation();a.opened=!0}}]);app.controller("adminMembers",["$scope","$http",function(a,e){a.names="Igor Minar;Brad Green;Dave Geddes;Naomi Black;Greg Weber;Dean Sofer;Wes Alvaro;John Scott;Daniel Nadasi".split(";");a.checked=!0;a.test=function(){arguments[3]()};a.test(a,e,"test",function(){})}]);