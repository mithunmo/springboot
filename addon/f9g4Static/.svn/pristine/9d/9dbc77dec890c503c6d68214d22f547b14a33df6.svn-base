app.controller("buyerSearch",["$scope","$http","$filter",function(a,d,f){a.asyncCompCount=0;a.syncIncompleted=!0;a.showCart=!1;a.isAdding={};a.isRemoving={};a.addedItems={};a.isCartSyncing=!1;a.clear=function(b){a.boardLevelList={};a.boardLevelList[4]={};a.selectedBoardLevelList={};a.portfolioCount=0;a.criteria={};b&&(a.langList={},a.skillList={},a.specialtyList={},a.expertiseList={},a.educationList={});a.criteria.designerName="";a.criteria.ratings=0;a.criteria.country="";a.criteria.priceRange=0;a.criteria.langs=null;a.criteria.selectItemlangs=null;a.criteria.misc="";a.criteria.keywords="";a.buyerRatingSlider={min:0,max:5,ceil:5,floor:0,step:1};a.priceSlider={min:0,max:2e4,ceil:2e4,floor:0,step:25};a.dt_start=null;a.dt_end=new Date;a.clearMultiSelect(a.langList);a.clearMultiSelect(a.skillList);a.clearMultiSelect(a.specialtyList);a.clearMultiSelect(a.expertiseList);a.clearMultiSelect(a.educationList)};a.updateList=function(b,c){var e;4>b&&(1==b?(e=ajaxPaths.categoryListPath+"/"+a.criteria.division,a.boardLevelList[2]={},a.boardLevelList[3]={},a.boardLevelList[4]={},a.criteria.category=null,a.criteria.product=null):2==b?(e=ajaxPaths.productListPath+"/"+a.criteria.category,a.boardLevelList[3]={},a.boardLevelList[4]={},a.criteria.product=null):(e=ajaxPaths.productTypeListPath+"?level1="+a.criteria.division+"&level2="+a.criteria.category+"&productTags="+encodeURIComponent(a.criteria.product),a.boardLevelList[4]=""),a.criteria.productType=null,d({method:"GET",url:e}).success(function(e){a.boardLevelList[b+1]=e.list;"function"==typeof c&&c()}).error(function(){}))};a.syncMultiSelect=function(b,c,e){for(var h in b)for(var g in c)1==e&&b[h].name==c[g]&&(b[h].ticked=!0),2==e&&b[h].lookupValueId==c[g]&&(b[h].ticked=!0);null!=c&&0<c.length&&a.updateAsyncCompCount()};a.clearMultiSelect=function(a){for(var c in a)a[c].ticked=!1};a.updateAsyncCompCount=function(){a.asyncCompCount--;0==a.asyncCompCount&&(a.syncIncompleted=!1)};a.syncCriteria=function(b){null==b.division?b.division=void 0:(a.criteria.division=b.division,a.updateList(1));null==b.category?b.category=void 0:(a.asyncCompCount++,a.criteria.category=b.category,a.updateList(2,function(){a.updateAsyncCompCount();null!=b.product&&""!=b.product&&(a.criteria.product=b.product)}));null==b.product||""==b.product?b.product=void 0:(a.asyncCompCount++,a.criteria.product=b.product,a.updateList(3,function(){a.updateAsyncCompCount();null!=b.productType&&0<b.productType.length&&a.syncMultiSelect(a.boardLevelList[4],b.productType,1)}));null!=b.productType&&0<b.productType.length&&a.asyncCompCount++;null!=b.langs&&0<b.langs.length&&a.asyncCompCount++;null!=b.skills&&0<b.skills.length&&a.asyncCompCount++;null!=b.splId&&0<b.splId.length&&a.asyncCompCount++;null!=b.expId&&0<b.expId.length&&a.asyncCompCount++;null!=b.eduId&&0<b.eduId.length&&a.asyncCompCount++;null==b.season&&(b.season=void 0);null==b.country&&(b.country=void 0);a.buyerRatingSlider.min=b.minBuyerRating;a.buyerRatingSlider.max=b.maxBuyerRating;a.priceSlider.min=b.minPrice;a.priceSlider.max=b.maxPrice;a.criteria=b;if(null!=b.portfolioSearchStartDate){var c=f("date")(b.portfolioSearchStartDate,"yyyy-MM-dd");a.dt_start=new Date(c)}null!=b.portfolioSearchEndDate&&(c=f("date")(b.portfolioSearchEndDate,"yyyy-MM-dd"),a.dt_end=new Date(c));0>=a.asyncCompCount&&(a.syncIncompleted=!1)};a.clear(!0);a.portfolioPagesCount="---";a.marketplaceSubmissionCount="---";a.profilesCount="---";a.examplesCount="---";d({method:"POST",url:ajaxPaths.searchCriteriaPath}).success(function(b){0==b.finalSearchResult?(a.portfolioPagesCount=0,a.marketplaceSubmissionCount=0,a.profilesCount=0,a.examplesCount=0,a.syncIncompleted=!1):(a.syncCriteria(b.finalSearchResult.form),void 0!=b.finalSearchResult.portfolioPages.data&&(a.portfolioPagesCount=b.finalSearchResult.portfolioPages.data.length),void 0!=b.finalSearchResult.marketplaceSubmission.data&&(a.marketplaceSubmissionCount=b.finalSearchResult.marketplaceSubmission.data.length),void 0!=b.finalSearchResult.profiles.data&&(a.profilesCount=b.finalSearchResult.profiles.data.length),void 0!=b.finalSearchResult.examples.data&&(a.examplesCount=b.finalSearchResult.examples.data.length))}).error(function(){});a.translate=function(a){return"$ "+a};d({method:"GET",url:ajaxPaths.langListPath}).success(function(b){a.langList=b.list;a.syncMultiSelect(b.list,a.criteria.langs,2)}).error(function(){});d({method:"GET",url:ajaxPaths.skillListPath}).success(function(b){a.skillList=b.list;a.syncMultiSelect(b.list,a.criteria.skills,2)}).error(function(){});d({method:"GET",url:ajaxPaths.specialtyListPath}).success(function(b){a.specialtyList=b.list;a.syncMultiSelect(b.list,a.criteria.splId,2)}).error(function(){});d({method:"GET",url:ajaxPaths.expertiseListPath}).success(function(b){a.expertiseList=b.list;a.syncMultiSelect(b.list,a.criteria.expId,2)}).error(function(){});d({method:"GET",url:ajaxPaths.educationListPath}).success(function(b){a.educationList=b.list;a.syncMultiSelect(b.list,a.criteria.eduId,2)}).error(function(){});a.search=function(){a.portfolioPagesCount="---";a.marketplaceSubmissionCount="---";a.profilesCount="---";a.examplesCount="---";a.criteria.portfolioSearchStartDate=null!=a.dt_start?a.dt_start.toDateString():null;a.criteria.portfolioSearchEndDate=null!=a.dt_end?a.dt_end.toDateString():null;a.criteria.minBuyerRating=a.buyerRatingSlider.min;a.criteria.maxBuyerRating=a.buyerRatingSlider.max;a.criteria.minPrice=a.priceSlider.min;a.criteria.maxPrice=a.priceSlider.max;for(var b=[],c=0;c<a.selectedBoardLevelList[4].length;c++)b.push(a.selectedBoardLevelList[4][c].name);a.criteria.productType=b;b=[];for(c=0;c<a.selectedLangList.length;c++)b.push(a.selectedLangList[c].lookupValueId);a.criteria.langs=b;b=[];for(c=0;c<a.selectedSkillList.length;c++)b.push(a.selectedSkillList[c].lookupValueId);a.criteria.skills=b;b=[];for(c=0;c<a.selectedExpertiseList.length;c++)b.push(a.selectedExpertiseList[c].lookupValueId);a.criteria.expId=b;b=[];for(c=0;c<a.selectedSpecialtyList.length;c++)b.push(a.selectedSpecialtyList[c].lookupValueId);a.criteria.splId=b;b=[];for(c=0;c<a.selectedEducationList.length;c++)b.push(a.selectedEducationList[c].lookupValueId);a.criteria.eduId=b;a.isSearching=!0;d({method:"GET",url:ajaxPaths.searchResultPath,params:a.criteria}).success(function(b){a.isSearching=!1;a.marketplaceSubmissionCount=b.result.marketplaceSubmission.data.length}).error(function(){a.isSearching=!1})};a.getCartItems=function(b){console.log("get cart items");a.isCartSyncing=!0;b&&(a.showCart=!0);d({method:"GET",url:ajaxPaths.cartPath}).success(function(b){a.shoppingCart=b;a.cartItemsCount=b.count;a.mapCartAddedItems(b.boardIdList);a.isCartSyncing=!1}).error(function(){a.isCartSyncing=!1})};a.addToCart=function(b){console.log(b);var c={boardId:b};a.isAdding[b]=!0;d({method:"POST",url:ajaxPaths.addCartItemPath,params:c}).success(function(e){console.log(e);a.isAdding[b]=!1;a.shoppingCart=e;a.cartItemsCount=e.count;a.mapCartAddedItems(e.boardIdList)}).error(function(){a.isAdding[b]=!1})};a.removeFromCart=function(b){var c={boardId:b};a.isRemoving[b]=!0;d({method:"POST",url:ajaxPaths.deleteCartItemPath,params:c}).success(function(e){console.log(e);a.isRemoving[b]=!1;a.shoppingCart=e;a.cartItemsCount=e.count;a.mapCartAddedItems(e.boardIdList)}).error(function(){a.isRemoving[b]=!1})};a.processItem=function(b){a.addedItems[b]?a.removeFromCart(b):a.addToCart(b)};a.mapCartAddedItems=function(b){a.addedItems={};for(var c in b)a.addedItems[b[c]]=!0};a.hideCart=function(){a.showCart=!1};a.cartItemsCount="---";a.getCartItems(!1)}]);app.controller("buyerSearchViewer",["$scope","$http","$filter","$location","$rootScope",function(a,d,f,b,c){a.columnNumber=10;a.showPanel={};a.loading={};a.boardDetail={};a.dt_start=null;a.dt_end=new Date;a.columnsPerRow=10;a.currentPage=0;a.totalPages=0;a.rowsPerPage=10;a.containerType={};a.selectedTab={};a.hasAdditionAccess=!1;a.isEmptyResult=!1;a.showCart=!1;a.isAdding={};a.isRemoving={};a.addedItems={};a.isCartSyncing=!1;a.render=function(){var b=(a.currentPage+1)*a.rowsPerPage*a.columnsPerRow,c=a.currentPage*a.rowsPerPage*a.columnsPerRow;b>=a.data.length&&(b=a.data.length);a.upperBound=b;a.lowerBound=c;a.items=a.data.slice(c,b)};a.updateRows=function(){a.totalPages=Math.floor(a.data.length/(a.rowsPerPage*a.columnsPerRow));0==a.data.length%(a.rowsPerPage*a.columnsPerRow)&&(a.totalPages-=1);a.render()};a.nextPage=function(){a.currentPage=a.currentPage+1>a.totalPages?0:a.currentPage+1;a.render()};a.prevPage=function(){a.currentPage=0>a.currentPage-1?a.totalPages:a.currentPage-1;a.render()};a.syncCriteria=function(b){null!=b.productType&&0<b.productType.length&&a.asyncCompCount++;null!=b.langs&&0<b.langs.length&&a.asyncCompCount++;null!=b.skills&&0<b.skills.length&&a.asyncCompCount++;null!=b.splId&&0<b.splId.length&&a.asyncCompCount++;null!=b.expId&&0<b.expId.length&&a.asyncCompCount++;null!=b.eduId&&0<b.eduId.length&&a.asyncCompCount++;null==b.season&&(b.season=void 0);null==b.country&&(b.country=void 0);a.criteria=b;if(null!=b.portfolioSearchStartDate){var c=f("date")(b.portfolioSearchStartDate,"yyyy-MM-dd");a.dt_start=new Date(c)}null!=b.portfolioSearchEndDate&&(c=f("date")(b.portfolioSearchEndDate,"yyyy-MM-dd"),a.dt_end=new Date(c));0>=a.asyncCompCount&&(a.syncIncompleted=!1)};a.search=function(){a.isUpdating=!0;a.criteria.portfolioSearchStartDate=null!=a.dt_start?a.dt_start.toDateString():null;a.criteria.portfolioSearchEndDate=null!=a.dt_end?a.dt_end.toDateString():null;d({method:"GET",url:ajaxPaths.searchResultPath,params:a.criteria}).success(function(b){a.injectData(b.result);a.updateRows();a.isUpdating=!1}).error(function(){})};a.dateChange=function(){a.search()};a.updateData=function(){console.log("update data: "+ajaxPaths.searchViewerPath);a.isUpdating=!0;a.isEmptyResult=!1;d({method:"POST",url:ajaxPaths.searchViewerPath}).success(function(b){console.log(b);0!=b.finalSearchResult&&void 0!=b.finalSearchResult?(a.injectData(b.finalSearchResult),a.syncCriteria(b.finalSearchResult.form),a.updateRows()):a.isEmptyResult=!0;a.isUpdating=!1}).error(function(){})};a.injectData=function(b){"portfolioPages"==a.containerType?(a.data=b.portfolioPages.data,a.hasAdditionAccess=!0):"marketplaceSubmissions"==a.containerType?(a.data=b.marketplaceSubmission.data,a.hasAdditionAccess=!1):"examples"==a.containerType&&(a.data=b.examples.data,a.hasAdditionAccess=!0)};a.navigate=function(b){""!=b&&void 0!=b&&!isNaN(parseInt(b))&&b<a.data.length&&0<b&&(a.currentPage=Math.floor(b/(a.rowsPerPage*a.columnsPerRow)),0==b%a.rowsPerPage&&a.currentPage--,a.render())};a.navigateHandler=function(b){(void 0==b||13==b.keyCode)&&a.navigate(a.itemIndex)};c.$on("$locationChangeStart",function(){a.containerType=b.hash();a.selectedTab={};a.selectedTab[b.hash()]="selected";a.updateData(a.containerType);a.currentPage=0;a.closeDetail();a.itemIndex=null});a.getDetail=function(b,c,g){a.loading[g]="loading";a.detailIndex=g;a.isSelected={};d({method:"GET",url:ajaxPaths.boardDetailPath+"/"+c}).success(function(b){var c=Math.floor(g/a.columnsPerRow);a.boardDetail=b;a.showPanel={};a.showPanel[c]=!0;a.loading={};a.isSelected[g]="selected"}).error(function(){})};a.closeDetail=function(b){void 0!=b?a.showPanel[Math.floor(b/a.columnsPerRow)]="":a.showPanel={};a.isSelected={}};a.showImageWindow=function(a){d({method:"GET",url:ajaxPaths.imageSizeRetrieverPath+"?img="+a}).success(function(b){var c=screen.width,d=screen.height,f=b.imageWidth;b=b.imageHeight;f>=.9*c&&(f=.9*c);b>=.85*d&&(b=.85*d);window.open(ajaxPaths.imageViewerPath+"?img="+a,"_blank","width="+f+",height="+b+",scrollbars=yes,toolbar=no,location=0")}).error(function(){})};a.filterList=function(a,b){var c=[];if(void 0!=a)for(var d=0;d<a.length;d++)1==a[d].publishToMP&&1==a[d].activeStatus&&a[d].boardId!=b&&c.push(a[d]);return c};a.showImgInfo=function(b){return a.showPanel[Math.floor(b/a.columnsPerRow)]};a.getCartItems=function(b){console.log("get cart items");a.isCartSyncing=!0;b&&(a.showCart=!0);d({method:"GET",url:ajaxPaths.cartPath}).success(function(b){a.shoppingCart=b;a.cartItemsCount=b.count;a.mapCartAddedItems(b.boardIdList);a.isCartSyncing=!1}).error(function(){a.isCartSyncing=!1})};a.addToCart=function(b){console.log(b);var c={boardId:b};a.isAdding[b]=!0;d({method:"POST",url:ajaxPaths.addCartItemPath,params:c}).success(function(c){console.log(c);a.isAdding[b]=!1;a.shoppingCart=c;a.cartItemsCount=c.count;a.mapCartAddedItems(c.boardIdList)}).error(function(){a.isAdding[b]=!1})};a.removeFromCart=function(b){var c={boardId:b};a.isRemoving[b]=!0;d({method:"POST",url:ajaxPaths.deleteCartItemPath,params:c}).success(function(c){console.log(c);a.isRemoving[b]=!1;a.shoppingCart=c;a.cartItemsCount=c.count;a.mapCartAddedItems(c.boardIdList)}).error(function(){a.isRemoving[b]=!1})};a.processItem=function(b){a.addedItems[b]?a.removeFromCart(b):a.addToCart(b)};a.mapCartAddedItems=function(b){a.addedItems={};for(var c in b)a.addedItems[b[c]]=!0};a.hideCart=function(){a.showCart=!1};a.cartItemsCount="---";a.getCartItems(!1)}]);app.controller("datePickerController",["$scope",function(a){a.open=function(d){d.preventDefault();d.stopPropagation();a.opened=!0}}]);