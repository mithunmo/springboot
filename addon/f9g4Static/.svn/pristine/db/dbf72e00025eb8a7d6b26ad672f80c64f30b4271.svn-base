(function(a,f){var g={init:function(e,d,b){var c=this;this.warning=e=a(e);this.resume=a(d);this.options=b;this.countdownOpen=!1;this.failedRequests=b.failedRequests;this._startTimer();this.title=document.title;this.options.debugMode&&console.log("Start idle timeout plugin");a.data(e[0],"idletimeout",this);a.idleTimer(1e3*b.idleAfter);a(document).bind("idle.idleTimer",function(){"idle"===a.data(document,"idleTimer")&&!c.countdownOpen&&(c._stopTimer(),c.countdownOpen=!0,c._idle())});this.resume.bind("click",function(a){a.preventDefault();f.clearInterval(c.countdown);c.countdownOpen=!1;c._startTimer();c._keepAlive(!1);b.onResume.call(c.warning)})},_idle:function(){var a=this,d=this.options,b=this.warning[0],c=d.warningLength;d.onIdle.call(b);d.onCountdown.call(b,c);this.countdown=f.setInterval(function(){0===--c?(window.clearInterval(a.countdown),d.onTimeout.call(b)):(d.onCountdown.call(b,c),document.title=d.titleMessage.replace("%s",c)+a.title)},1e3)},_startTimer:function(){var a=this;this.timer=f.setTimeout(function(){a._keepAlive()},1e3*this.options.pollingInterval)},_stopTimer:function(){this.failedRequests=this.options.failedRequests;f.clearTimeout(this.timer)},_keepAlive:function(e){var d=this,b=this.options;document.title=d.title;"undefined"===typeof e&&(e=!0);if(this.failedRequests){var c=new Date,f=c.getHours(),g=c.getMinutes(),c=c.getSeconds();b.debugMode&&(console.log("--------------------------------------------------------"),console.log("Send keep session alive=>"+f+":"+g+":"+c));a.ajax({timeout:b.AJAXTimeout,url:b.keepAliveURL,beforeSend:function(){b.debugMode&&console.log("Send ajax request")},error:function(){b.debugMode&&console.log("request failed");d.failedRequests--},success:function(c){b.debugMode&&console.log("get response");a.trim(c)!==b.serverResponseEquals&&(b.debugMode&&console.log("unexpected response text"),d.failedRequests--,"true"==a("#sessionTimeout",a(c)).val()&&b.onRedirect.call())},complete:function(){e&&(b.debugMode&&console.log("keep polling"),d._startTimer())}})}else this._stopTimer(),b.onAbort.call(this.warning[0])}};a.idleTimeout=function(e,d,b){g.init(e,d,a.extend(a.idleTimeout.options,b));return this};a.idleTimeout.options={warningLength:30,keepAliveURL:"",serverResponseEquals:"OK",idleAfter:600,pollingInterval:60,failedRequests:5,AJAXTimeout:2500,titleMessage:"Warning: %s seconds until log out | ",debugMode:!1,onTimeout:a.noop,onIdle:a.noop,onCountdown:a.noop,onResume:a.noop,onAbort:a.noop,onRedirect:a.noop}})(jQuery,window);