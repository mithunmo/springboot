(function(c){function j(a,b){var d=this,e=a.attr("name")||b.name||"",g=a.outerWidth();this.$el=a.hide();this.options=b;this.$parent=c('<div class="ms-parent"></div>');this.$choice=c('<button type="button" class="ms-choice"><span class="placeholder">'+b.placeholder+"</span><div></div></button>");this.$drop=c('<div class="ms-drop '+b.position+'"></div>');this.$el.after(this.$parent);this.$parent.append(this.$choice);this.$parent.append(this.$drop);this.$el.prop("disabled")&&this.$choice.addClass("disabled");this.$parent.css("width",b.width||g);this.options.keepOpen||c("body").click(function(a){c(a.target)[0]===d.$choice[0]||c(a.target).parents(".ms-choice")[0]===d.$choice[0]||(c(a.target)[0]===d.$drop[0]||c(a.target).parents(".ms-drop")[0]!==d.$drop[0])&&d.options.isOpen&&d.close()});this.selectAllName='name="selectAll'+e+'"';this.selectGroupName='name="selectGroup'+e+'"';this.selectItemName='name="selectItem'+e+'"'}j.prototype={constructor:j,init:function(){var a=this,b=[];this.options.filter&&b.push('<div class="ms-search">','<input type="text" autocomplete="off" autocorrect="off" autocapitilize="off" spellcheck="false">',"</div>");b.push("<ul>");this.options.selectAll&&!this.options.single&&b.push("<li>","<label>",'<input type="checkbox" '+this.selectAllName+" /> ","["+this.options.selectAllText+"]","</label>","</li>");c.each(this.$el.children(),function(d,c){b.push(a.optionToHtml(d,c))});b.push('<li class="ms-no-results">No matches found</li>');b.push("</ul>");this.$drop.html(b.join(""));this.$drop.find("ul").css("max-height",this.options.maxHeight+"px");this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px");this.$searchInput=this.$drop.find(".ms-search input");this.$selectAll=this.$drop.find("input["+this.selectAllName+"]");this.$selectGroups=this.$drop.find("input["+this.selectGroupName+"]");this.$selectItems=this.$drop.find("input["+this.selectItemName+"]:enabled");this.$disableItems=this.$drop.find("input["+this.selectItemName+"]:disabled");this.$noResults=this.$drop.find(".ms-no-results");this.events();this.update();this.options.isOpen&&this.open()},optionToHtml:function(a,b,d,e){var g=this;b=c(b);var h=[],k=this.options.multiple,f,m=this.options.single?"radio":"checkbox";if(b.is("option")){a=b.val();var j=b.text(),n=b.prop("selected"),p=this.options.styler(a)?' style="'+this.options.styler(a)+'"':"";f=e||b.prop("disabled");h.push("<li"+(k?' class="multiple"':"")+p+">","<label"+(f?' class="disabled"':"")+">",'<input type="'+m+'" '+this.selectItemName+' value="'+a+'"'+(n?' checked="checked"':"")+(f?' disabled="disabled"':"")+(d?' data-group="'+d+'"':"")+"/> ",j,"</label>","</li>")}else if(!d&&b.is("optgroup")){var l="group_"+a;d=b.attr("label");f=b.prop("disabled");h.push('<li class="group">','<label class="optgroup'+(f?" disabled":"")+'" data-group="'+l+'">','<input type="checkbox" '+this.selectGroupName+(f?' disabled="disabled"':"")+" /> ",d,"</label>","</li>");c.each(b.children(),function(a,b){h.push(g.optionToHtml(a,b,l,f))})}return h.join("")},events:function(){var a=this;this.$choice.off("click").on("click",function(b){b.preventDefault();a[a.options.isOpen?"close":"open"]()}).off("focus").on("focus",this.options.onFocus).off("blur").on("blur",this.options.onBlur);this.$parent.off("keydown").on("keydown",function(b){switch(b.which){case 27:a.close(),a.$choice.focus()}});this.$searchInput.off("keyup").on("keyup",function(){a.filter()});this.$selectAll.off("click").on("click",function(){var b=c(this).prop("checked"),d=a.$selectItems.filter(":visible");if(d.length===a.$selectItems.length)a[b?"checkAll":"uncheckAll"]();else a.$selectGroups.prop("checked",b),d.prop("checked",b),a.options[b?"onCheckAll":"onUncheckAll"](),a.update()});this.$selectGroups.off("click").on("click",function(){var b=c(this).parent().attr("data-group"),b=a.$selectItems.filter(":visible").filter('[data-group="'+b+'"]'),d=b.length!==b.filter(":checked").length;b.prop("checked",d);a.updateSelectAll();a.update();a.options.onOptgroupClick({label:c(this).parent().text(),checked:d,children:b.get()})});this.$selectItems.off("click").on("click",function(){a.updateSelectAll();a.update();a.updateOptGroupSelect();a.options.onClick({label:c(this).parent().text(),value:c(this).val(),checked:c(this).prop("checked")});a.options.single&&a.options.isOpen&&!a.options.keepOpen&&a.close()})},open:function(){if(!this.$choice.hasClass("disabled")){this.options.isOpen=!0;this.$choice.find(">div").addClass("open");this.$drop.show();this.$selectAll.parent().show();this.$noResults.hide();if(this.options.container){var a=this.$drop.offset();this.$drop.appendTo(c(this.options.container));this.$drop.offset({top:a.top,left:a.left})}this.options.filter&&(this.$searchInput.val(""),this.filter());this.options.onOpen()}},close:function(){this.options.isOpen=!1;this.$choice.find(">div").removeClass("open");this.$drop.hide();this.options.container&&(this.$parent.append(this.$drop),this.$drop.css({top:"auto",left:"auto"}));this.options.onClose()},update:function(){var a=this.getSelects("text"),b=this.$choice.find(">span");a.length===this.$selectItems.length+this.$disableItems.length&&this.options.allSelected?b.removeClass("placeholder").html(this.options.allSelected):a.length>this.options.minumimCountSelected&&this.options.countSelected?b.removeClass("placeholder").html(this.options.countSelected.replace("#",a.length).replace("%",this.$selectItems.length+this.$disableItems.length)):a.length?b.removeClass("placeholder").html(a.join(", ")):b.addClass("placeholder").html(this.options.placeholder);this.$el.val(this.getSelects())},updateSelectAll:function(){var a=this.$selectItems.filter(":visible");this.$selectAll.prop("checked",a.length&&a.length===a.filter(":checked").length);if(this.$selectAll.prop("checked"))this.options.onCheckAll()},updateOptGroupSelect:function(){var a=this.$selectItems.filter(":visible");c.each(this.$selectGroups,function(b,d){var e=c(d).parent().attr("data-group"),e=a.filter('[data-group="'+e+'"]');c(d).prop("checked",e.length&&e.length===e.filter(":checked").length)})},getSelects:function(a){var b=this,d=[],e=[];this.$drop.find("input["+this.selectItemName+"]:checked").each(function(){d.push(c(this).parent().text());e.push(c(this).val())});"text"===a&&this.$selectGroups.length&&(d=[],this.$selectGroups.each(function(){var a=[],e=c.trim(c(this).parent().text()),k=c(this).parent().data("group"),k=b.$drop.find("["+b.selectItemName+'][data-group="'+k+'"]'),f=k.filter(":checked");if(0!==f.length){a.push("[");a.push(e);if(k.length>f.length){var j=[];f.each(function(){j.push(c(this).parent().text())});a.push(": "+j.join(", "))}a.push("]");d.push(a.join(""))}}));return"text"===a?d:e},setSelects:function(a){var b=this;this.$selectItems.prop("checked",!1);c.each(a,function(a,c){b.$selectItems.filter('[value="'+c+'"]').prop("checked",!0)});this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length);this.update()},enable:function(){this.$choice.removeClass("disabled")},disable:function(){this.$choice.addClass("disabled")},checkAll:function(){this.$selectItems.prop("checked",!0);this.$selectGroups.prop("checked",!0);this.$selectAll.prop("checked",!0);this.update();this.options.onCheckAll()},uncheckAll:function(){this.$selectItems.prop("checked",!1);this.$selectGroups.prop("checked",!1);this.$selectAll.prop("checked",!1);this.update();this.options.onUncheckAll()},focus:function(){this.$choice.focus();this.options.onFocus()},blur:function(){this.$choice.blur();this.options.onBlur()},refresh:function(){this.init()},filter:function(){var a=this,b=c.trim(this.$searchInput.val()).toLowerCase();0===b.length?(this.$selectItems.parent().show(),this.$disableItems.parent().show(),this.$selectGroups.parent().show()):(this.$selectItems.each(function(){var a=c(this).parent();a[0>a.text().toLowerCase().indexOf(b)?"hide":"show"]()}),this.$disableItems.parent().hide(),this.$selectGroups.each(function(){var b=c(this).parent(),e=b.attr("data-group"),g=a.$selectItems.filter(":visible");b[0===g.filter('[data-group="'+e+'"]').length?"hide":"show"]()}),this.$selectItems.filter(":visible").length?(this.$selectAll.parent().show(),this.$noResults.hide()):(this.$selectAll.parent().hide(),this.$noResults.show()));this.updateOptGroupSelect();this.updateSelectAll()}};c.fn.multipleSelect=function(){var a=arguments[0],b=arguments,d,e="getSelects setSelects enable disable checkAll uncheckAll focus blur refresh".split(" ");this.each(function(){var g=c(this),h=g.data("multipleSelect"),k=c.extend({},c.fn.multipleSelect.defaults,g.data(),"object"===typeof a&&a);h||(h=new j(g,k),g.data("multipleSelect",h));if("string"===typeof a){if(0>c.inArray(a,e))throw"Unknown method: "+a;d=h[a](b[1])}else h.init()});return d?d:this};c.fn.multipleSelect.defaults={name:"",isOpen:!1,placeholder:"",selectAll:!0,selectAllText:"Select all",allSelected:"All selected",minumimCountSelected:3,countSelected:"# of % selected",multiple:!1,multipleWidth:80,single:!1,filter:!1,width:void 0,maxHeight:250,container:null,position:"bottom",keepOpen:!1,styler:function(){return!1},onOpen:function(){return!1},onClose:function(){return!1},onCheckAll:function(){return!1},onUncheckAll:function(){return!1},onFocus:function(){return!1},onBlur:function(){return!1},onOptgroupClick:function(){return!1},onClick:function(){return!1}}})(jQuery);